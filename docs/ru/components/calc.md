# Описание компонента калькулятора
## Основное назначение
Компонент CalcComponent представляет собой интегрированный калькулятор с двумя режимами работы:

    Основной калькулятор - постоянно отображается в интерфейсе

    Всплывающий калькулятор - интегрируется с формой для заполнения полей

## Ключевые особенности:
1. Архитектура и интерфейсы
    Интерфейс CalculatorButton: Унифицированная структура для кнопок калькулятора
```typescript   
interface CalculatorButton {
  label: string;    // Отображаемый текст
  action: string;   // Действие (для логики)
  color: string;    // Цвет кнопки (Ionic цвета)
  value: string;    // Значение для обработки
}
```
2. Режимы работы
    Базовый режим: Стандартные арифметические операции
    Расширенный режим: Дополнительные математические функции (тригонометрия, логарифмы и др.)
    Переключение через toggleMode() и isExtendedMode

3. Многоязычность (i18n)
    Автоматическое обновление при смене языка

4. Двойной интерфейс
    Основной калькулятор,
    Попап-калькулятор,
    Единая логика обработки для обоих интерфейсов

## Критически важная логика:
1. Обработка математических выражений

    ```typescript
    private calculateLogic(expr: string): string
    ```

    Безопасное вычисление через new Function()
    Поддержка математических функций через преобразование в Math.*
    Обработка ошибок и округление результатов
2. Управление скобками

    ```typescript
    private toggleBracketsLogic(expr: string): string 
    ```

    Интеллектуальное добавление скобок
    Балансировка открывающих/закрывающих скобок
    Автоматическая вставка оператора умножения перед скобкой

3. Процентные вычисления

    ```typescript
    private percentageLogic(expr: string): string
    ```

    Обработка процентов от последнего числа
    Поддержка процентов от всего выражения

4. Обработка клавиатуры

    ```typescript
    @HostListener('document:keydown', ['$event'])
    ```

    Полная поддержка клавиатурного ввода
    Горячие клавиши (Enter, Escape, Backspace)
    Преобразование символов (^ -> **)

### Потоки данных:
Два основных состояния:

- Основное выражение (expression) 
- для главного калькулятора
- Попап-выражение (popupExpression) - для формы

Интеграция с формой:
- inputValue - значение поля ввода формы
- applyCalculation() - передача результата из попапа в форму
- clearForm() - очистка поля формы

### Безопасность и обработка ошибок:
Важные меры:
- Безопасный eval: Использование new Function() вместо eval()
- Валидация результатов: Проверка isFinite() и isNaN()
- Стандартизация выражений: Замена нестандартных символов
### Производительность:
- Разделение кнопок: Отдельные массивы для базового/расширенного режимов
- Мемоизация: getCurrentButtons() для динамического выбора кнопок

### Стилистические особенности:
- Использование Ionic компонентов (ion-button, ion-card, ion-segment)
- Адаптивная верстка (ion-grid с разбивкой на колонки)
- Семантическая цветовая схема:

    primary - основное действие (=)

    danger - очистка (C)

    warning - операторы (+, -, *, /)

    tertiary - расширенные функции

## Резюме главных преимуществ:
### Гибкость
    Два режима калькулятора (базовый/расширенный)
    Два интерфейса
    Полная клавиатурная навигация

### Безопасность
    Защищенное вычисление выражений
    Комплексная обработка ошибок
    Валидация математических операций
### Интеграция
    Готовность к использованию в формах
    Многоязычная поддержка
    Адаптивный дизайн

### Поддерживаемость
    Четкое разделение логики
    Модульная структура кнопок
    Комментированный и структурированный код

# Рекомендации для улучшения:
- Реализовать историю вычислений
- Добавить поддержку тем (темный/светлый режим)
- Добавить больше функций, кнопок в рассширенный режим
>Компонент является продуманным и комплексным решением, сочетающим математическую функциональность, удобный интерфейс и безопасность выполнения операций.