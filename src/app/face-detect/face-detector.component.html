<ion-header>
  <ion-toolbar class="custom-toolbar">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title class="custom-title">
      –î–µ—Ç–µ–∫—Ç–æ—Ä –õ–∏—Ü
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="detector-content">
  <div class="detector-container">
    
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div *ngIf="loading" class="loading-container animate-in">
      <div class="loading-card">
        <div class="spinner-container">
          <div class="modern-spinner"></div>
        </div>
        <h2>–ó–∞–≥—Ä—É–∑–∫–∞ AI –º–æ–¥–µ–ª–µ–π</h2>
        <p class="loading-text">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MediaPipe Vision...</p>
        <div class="loading-steps">
          <div class="step">
            <div class="step-icon">üß†</div>
            <span>Face Detector</span>
          </div>
          <div class="step">
            <div class="step-icon">üëã</div>
            <span>Gesture Recognition</span>
          </div>
          <div class="step">
            <div class="step-icon">üìπ</div>
            <span>Camera Access</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ -->
    <div *ngIf="error" class="error-container animate-in">
      <div class="error-card">
        <ion-icon name="warning-outline" class="error-icon"></ion-icon>
        <h2>–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
        <p class="error-message">{{ error }}</p>
        <ion-button 
          (click)="initDetectors()" 
          class="retry-button"
          expand="block">
          <ion-icon name="refresh-outline" slot="start"></ion-icon>
          –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
        </ion-button>
      </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–µ—Ç–µ–∫—Ü–∏–∏ -->
    <div class="detection-workspace" [class.hidden]="loading || error">
      
      <!-- –í–∏–¥–µ–æ —Å –Ω–∞–ª–æ–∂–µ–Ω–∏—è–º–∏ -->
      <div class="video-wrapper">
        <!-- Canvas –¥–ª—è —á–∞—Å—Ç–∏—Ü (–Ω–∏–∂–Ω–∏–π —Å–ª–æ–π) -->
        <canvas #particleCanvas class="particle-canvas"></canvas>
        
        <!-- –í–∏–¥–µ–æ -->
        <video 
          #video 
          class="video-feed"
          playsinline 
          muted
          autoplay>
        </video>
        
        <!-- Canvas –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ (–≤–µ—Ä—Ö–Ω–∏–π —Å–ª–æ–π) -->
        <canvas #canvas class="detection-canvas"></canvas>
        
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ -->
        <div class="recording-indicator">
          <div class="pulse-dot"></div>
        </div>
      </div>

      <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
      <div class="control-panel">
        <ion-button 
          [color]="cameraEnabled ? 'success' : 'danger'"
          (click)="toggleCamera()"
          size="small"
          expand="block">
          <ion-icon [name]="cameraEnabled ? 'videocam' : 'videocam-off'" slot="start"></ion-icon>
          {{ cameraEnabled ? '–ö–∞–º–µ—Ä–∞ –≤–∫–ª' : '–ö–∞–º–µ—Ä–∞ –≤—ã–∫–ª' }}
        </ion-button>

        <ion-button 
          [color]="faceDetectionEnabled ? 'primary' : 'medium'"
          (click)="toggleFaceDetection()"
          [disabled]="!cameraEnabled"
          size="small"
          expand="block">
          <ion-icon name="person-outline" slot="start"></ion-icon>
          {{ faceDetectionEnabled ? '–õ–∏—Ü–∞ –≤–∫–ª' : '–õ–∏—Ü–∞ –≤—ã–∫–ª' }}
        </ion-button>

        <ion-button 
          [color]="gestureDetectionEnabled ? 'secondary' : 'medium'"
          (click)="toggleGestureDetection()"
          [disabled]="!cameraEnabled"
          size="small"
          expand="block">
          <ion-icon name="hand-left-outline" slot="start"></ion-icon>
          {{ gestureDetectionEnabled ? '–ñ–µ—Å—Ç—ã –≤–∫–ª' : '–ñ–µ—Å—Ç—ã –≤—ã–∫–ª' }}
        </ion-button>
      </div>

      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–∏ -->
      <div class="info-section recognition-info" [class.collapsed]="recognitionInfoCollapsed">
        <div class="section-header" (click)="recognitionInfoCollapsed = !recognitionInfoCollapsed">
          <div class="header-left">
            <ion-icon name="information-circle-outline"></ion-icon>
            <span>–ß—Ç–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ</span>
          </div>
          <ion-icon [name]="recognitionInfoCollapsed ? 'chevron-down-outline' : 'chevron-up-outline'"></ion-icon>
        </div>
        
        <div class="section-content">
          <div class="recognition-list">
            <div *ngFor="let info of recognitionInfo" class="recognition-item">
              {{ info }}
            </div>
          </div>
        </div>
      </div>

      <!-- –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–∫–æ–º–ø–∞–∫—Ç–Ω–∞—è, —Å–∫—Ä—ã–≤–∞–µ–º–∞—è) -->
      <div class="stats-panel" [class.collapsed]="statsCollapsed">
        <div class="panel-header" (click)="statsCollapsed = !statsCollapsed">
          <div class="header-left">
            <ion-icon name="stats-chart-outline"></ion-icon>
            <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
          </div>
          <ion-icon [name]="statsCollapsed ? 'chevron-down-outline' : 'chevron-up-outline'"></ion-icon>
        </div>
        
        <div class="panel-content">
          <div class="stat-card faces">
            <div class="stat-icon">üë§</div>
            <div class="stat-content">
              <div class="stat-value">{{ stats.faces }}</div>
              <div class="stat-label">–õ–∏—Ü–∞</div>
            </div>
          </div>

          <div class="stat-card confidence">
            <div class="stat-icon">üéØ</div>
            <div class="stat-content">
              <div class="stat-value">{{ stats.confidence.toFixed(0) }}%</div>
              <div class="stat-label">–¢–æ—á–Ω–æ—Å—Ç—å</div>
            </div>
          </div>

          <div class="stat-card gestures">
            <div class="stat-icon">‚úã</div>
            <div class="stat-content">
              <div class="stat-value">{{ stats.gestures.length }}</div>
              <div class="stat-label">–ñ–µ—Å—Ç—ã</div>
            </div>
          </div>

          <div class="stat-card fps">
            <div class="stat-icon">‚ö°</div>
            <div class="stat-content">
              <div class="stat-value">{{ stats.fps }}</div>
              <div class="stat-label">FPS</div>
            </div>
          </div>
        </div>
      </div>

      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å (–∫–æ–º–ø–∞–∫—Ç–Ω–∞—è, —Å–∫—Ä—ã–≤–∞–µ–º–∞—è) -->
      <div class="info-panel">
        <!-- –ñ–µ—Å—Ç—ã -->
        <div class="info-section" [class.collapsed]="gesturesCollapsed">
          <div class="section-header" (click)="gesturesCollapsed = !gesturesCollapsed">
            <div class="header-left">
              <ion-icon name="hand-left-outline"></ion-icon>
              <span>–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–µ–º—ã–µ –∂–µ—Å—Ç—ã</span>
            </div>
            <ion-icon [name]="gesturesCollapsed ? 'chevron-down-outline' : 'chevron-up-outline'"></ion-icon>
          </div>
          
          <div class="section-content">
            <div class="gesture-grid">
              <div class="gesture-item">
                <span class="gesture-emoji">üëç</span>
                <span class="gesture-name">–õ–∞–π–∫</span>
              </div>
              <div class="gesture-item">
                <span class="gesture-emoji">‚úåÔ∏è</span>
                <span class="gesture-name">–ü–æ–±–µ–¥–∞</span>
              </div>
              <div class="gesture-item">
                <span class="gesture-emoji">‚úä</span>
                <span class="gesture-name">–ö—É–ª–∞–∫</span>
              </div>
              <div class="gesture-item">
                <span class="gesture-emoji">üñêÔ∏è</span>
                <span class="gesture-name">–õ–∞–¥–æ–Ω—å</span>
              </div>
              <div class="gesture-item">
                <span class="gesture-emoji">‚òùÔ∏è</span>
                <span class="gesture-name">–í–≤–µ—Ä—Ö</span>
              </div>
              <div class="gesture-item">
                <span class="gesture-emoji">ü§ü</span>
                <span class="gesture-name">ILY</span>
              </div>
            </div>
          </div>
        </div>

        <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –¥–µ—Ç–µ–∫—Ü–∏–∏ -->
        <div class="info-section" [class.collapsed]="detectionsCollapsed">
          <div class="section-header" (click)="detectionsCollapsed = !detectionsCollapsed">
            <div class="header-left">
              <ion-icon name="layers-outline"></ion-icon>
              <span>–ê–∫—Ç–∏–≤–Ω—ã–µ –¥–µ—Ç–µ–∫—Ü–∏–∏</span>
            </div>
            <ion-icon [name]="detectionsCollapsed ? 'chevron-down-outline' : 'chevron-up-outline'"></ion-icon>
          </div>
          
          <div class="section-content">
            <div class="active-detections">
              <div class="detection-badge face-badge">
                <span class="badge-dot"></span>
                –î–µ—Ç–µ–∫—Ü–∏—è –ª–∏—Ü
              </div>
              <div class="detection-badge hand-badge">
                <span class="badge-dot"></span>
                –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∂–µ—Å—Ç–æ–≤
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
    
  </div>
</ion-content>
